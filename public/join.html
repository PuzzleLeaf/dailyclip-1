<!DOCTYPE html>
<html lang="ko">
<head>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta property="og:title" content="DAILY CLIP">
<meta property="og:description" content="앱에 대한 설명 들어갈 자리">
<meta property="og:image" content="">
<meta property="og:url" content="">
<link rel="stylesheet" href="css/common.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<title>DAILY CLIP</title>
<script src="https://www.gstatic.com/firebasejs/4.4.0/firebase.js"></script>
<script src="https://code.jquery.com/jquery-latest.min.js" ></script>
<script>
	//파이어베이스 접근 설정
	var config = {
	  apiKey: "AIzaSyBlRXKU6mf9KGW1cqUNThHuQu825qKd0MA",
	  authDomain: "dailyclip-b64d3.firebaseapp.com",
	  databaseURL: "https://dailyclip-b64d3.firebaseio.com",
	  projectId: "dailyclip-b64d3",
	  storageBucket: "dailyclip-b64d3.appspot.com",
	  messagingSenderId: "753746341919"
	};
	
	firebase.initializeApp(config);
	
	var database = firebase.database();
	
	function fnNewMember(){
		var email = $('#userEmail').val();
		var userPwd1 = $('#userPwd1').val();
		var userPwd2 = $('#userPwd2').val();
		var userBirth = $('#userBirth').val();
		var userGender = $('#userGender').val();
		
		if(userPwd1 != userPwd2){
			alert('패스워드를 다시 확인해주세요');
			$('#userPwd1').val('');
			$('#userPwd1').focus();
			$('#userPwd2').val('');
			return false;
		}else{
			
			if(confirm('회원가입을 진행하시겠습니까?')){
				
				//회원가입을 위한 기능
				firebase.auth().createUserWithEmailAndPassword(email, userPwd1)
				.then(function(){
					PushNewUser(email , userBirth , userGender);
				})
				.catch(function(error) {
			        // Handle Errors here.
			        var errorCode = error.code;
			        var errorMessage = error.message;
			       
			        // [START_EXCLUDE]
			        if (errorCode == 'auth/weak-password') {
			          alert('패스워드가 매우 취약합니다. 다시설정해주시기 바랍니다.');
			          success = 'false';
			        } else if (errorCode == 'auth/invalid-email') {
			            alert('이메일 주소의 형식이 잘못되었습니다.');
			            success = 'false';
			        } else if (errorCode == 'auth/email-already-in-use') {
			            alert('이메일 주소는 이미 다른 계정에서 사용 중입니다.');
			            success = 'false';
			        } else {
			          //alert(errorMessage);
			          success = 'false';
			        }
			        //console.log(error);
			        // [END_EXCLUDE]
			    });
			}
		}
	}
	
	//회원정보 등록	
	function PushNewUser(email , birth , gender) {  
	    var postData = {
	    	email : email,
	    	birth : birth,
	    	gender : gender
	    };
	    var newPostKey = firebase.database().ref().child('users').push().key;
	    var updates = {};
	    updates['/users/' + newPostKey] = postData;
	    var result=firebase.database().ref().update(updates);
	    
	    location.href="index.html";
	}
</script>
</head>
<body >
<div id="wrap">
	<div id="join">
		<div class="join_area">
			<div class="join_box">
				<span><img src="images/join_icon_01.png"></span>
				<label for="" id="" class="">이메일</label>
				<input type="text" id="userEmail" name="userEmail" maxlength="" title="" placeholder="이메일 (ID)" size="30">
			</div>
			<div class="join_box">
				<span><img src="images/join_icon_02.png"></span>
				<label for="" id="" class="">비밀번호</label>
				<input type="password" id="userPwd1" name="userPwd1" maxlength="" title="" placeholder="비밀번호" size="30">
			</div>
			<div class="join_box">
				<span><img src="images/join_icon_02.png"></span>
				<label for="" id="" class="">비밀번호 확인</label>
				<input type="password" id="userPwd2" name="userPwd2" maxlength="" title="" placeholder="비밀번호 확인" size="30">
			</div>
			<div class="select_box">
				<ul>
					<li>
						<span><img src="images/join_icon_03.png"></span>
						<select name="userBirth" id="userBirth">
							<option value="">출생년도</option>
							<option value="1991">1991</option>
							<option value="1992">1992</option>
							<option value="1993">1993</option>
							<option value="1994">1994</option>
							<option value="1995">1995</option>
							<option value="1996">1996</option>
							<option value="1997">1997</option>
							<option value="1998">1998</option>
							<option value="1999">1999</option>
							<option value="2000">2000</option>
							<option value="2001">2001</option>
							<option value="2002">2002</option>
							<option value="2003">2003</option>
							<option value="2004">2004</option>
							<option value="2005">2005</option>
							<option value="2006">2006</option>
						 </select>
					 </li>
					 <li>
						<span><img src="images/join_icon_04.png"></span>
						<select name="userGender" id="userGender">
							<option value="">성별</option>
							<option value="male">남자</option>
							<option value="famale">여자</option>
						 </select>
					 </li>
				 </ul>
			</div>
		</div>
		<button type="button" onclick="fnNewMember();">
			<span>로그인</span>
		</button>
	</div>
</div>
</body>
</html>
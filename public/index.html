<!DOCTYPE html>
<html lang="ko">
<head>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta property="og:title" content="DAILY CLIP">
<meta property="og:description" content="앱에 대한 설명 들어갈 자리">
<meta property="og:image" content="">
<meta property="og:url" content="">
<link rel="stylesheet" href="css/common.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<title>DAILY CLIP</title>
<script src="https://www.gstatic.com/firebasejs/4.4.0/firebase.js"></script>
<script src="https://code.jquery.com/jquery-latest.min.js" ></script>
<script>

	//Initialize Firebase
	// 파이어베이스 접근 설정
	var config = {
	  apiKey: "AIzaSyBlRXKU6mf9KGW1cqUNThHuQu825qKd0MA",
	  authDomain: "dailyclip-b64d3.firebaseapp.com",
	  databaseURL: "https://dailyclip-b64d3.firebaseio.com",
	  projectId: "dailyclip-b64d3",
	  storageBucket: "dailyclip-b64d3.appspot.com",
	  messagingSenderId: "753746341919"
	};
	
	firebase.initializeApp(config);
	
	var database = firebase.database();


	//현재 로그인한 사용자 가져오기
	firebase.auth().onAuthStateChanged(function(user) {
	 	if(user){
	 		try{
	 			fnAutoLogin(App.getUserId(),App.getUserPw());
	 		}catch(err){
	 			if(err.name =="ReferenceError"){
	 				alert("NO!");
	 			  var displayName = user.displayName;
		          var email = user.email;
		          var emailVerified = user.emailVerified;
		          var photoURL = user.photoURL;
		          var isAnonymous = user.isAnonymous;
		          var uid = user.uid;
		          var providerData = user.providerData;

		          //location.href="list.html";
		          location.href="info.html";
	 			}
	 		}
	 	}else{
	 		return false;
	 	}
	});

  function fnAutoLogin(userId, userPw){

  	if(userId == null || userPw == null){
  		return;
  	}
  	alert("앱 로그인");

  	firebase.auth().signInWithEmailAndPassword(userId, userPw)
    .then(function(){
    	location.href="list.html";
    }).catch(function(error) {
		// Handle Errors here.
		var errorCode = error.code;
		var errorMessage = error.message;
		// [START_EXCLUDE]
		if (errorCode === 'auth/wrong-password') {
		  alert('패스워드가 틀렸습니다. 다시확인해주세요');
		  App.setUserLoginData(null,null);
		  $('#loginPw').val('');
		  $('#loginPw').focus();
		  return false;
		} else {
		  alert(errorMessage);
		}
		console.log(error);
		// [END_EXCLUDE]
    }); 

  }
  
  function fnLogin(){
	var loginId = $('#loginId').val();
	var loginPw = $('#loginPw').val();
	var success = 'true';
	
    //이메일과 패스워드를 사용해 로그인확인
    firebase.auth().signInWithEmailAndPassword(loginId, loginPw)
    .then(function(){
    	try{
    		App.setUserLoginData(loginId,loginPw);
    	}catch(err){
    		if(err.name =="ReferenceError"){
    			alert("웹 로그인");
    		}
    	}finally{
    		location.href="list.html";
    	}
    })
    .catch(function(error) {
		// Handle Errors here.
		var errorCode = error.code;
		var errorMessage = error.message;
		// [START_EXCLUDE]
		if (errorCode === 'auth/wrong-password') {
			try{
    		  App.setUserLoginData(null,null);
    		}catch(err){
    			if(err.name =="ReferenceError"){

    			}
    		}
		
		  alert('패스워드가 틀렸습니다. 다시확인해주세요');
		  $('#loginPw').val('');
		  $('#loginPw').focus();
		  return false;
		} else {
		  alert(errorMessage);
		}
		console.log(error);
		// [END_EXCLUDE]
    }); 
    
  }
  
  //엔터키 이벤트
  function enterKeyCheck(keyCode){
	  if(keyCode == '13'){
		  fnLogin();
	  }
  }
</script>
</head>
<body onLoad>
<div id="wrap">
	<div id="main">
		<div class="login_area">
			<div class="input_box">
				<span><img src=""></span>
				<label for="loginId" id="label_id" class="lbl_in">아이디</label>
				<input type="text" id="loginId" name="loginId" maxlength="" title="아이디" placeholder="이메일 (ID)" size="20">
			</div>
			<div class="input_box">
				<span><img src=""></span>
				<label for="loginPw" id="label_pw" class="lbl_in">비밀번호</label>
				<input type="password" id="loginPw" name="loginPw" maxlength="" title="비밀번호" placeholder="비밀번호" size="20" onkeypress="enterKeyCheck(event.keyCode);">
			</div>
			<div class="btn_login">
				<a href="#" onclick="fnLogin();"><span>LOG IN</span></a>
			</div>
			<div class="btn_help">
				<span class="join_help"><a href="join.html">회원가입</a></span>
				<span class="search_help"><a href="#">ID/PW 찾기</a></span>
			<div>
		</div>
	</div>
</div>
</body>
</html>